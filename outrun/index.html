<html>

<body style="background-color:black; margin:0px;">
    <canvas id="canvas" width="1024" height="768"></canvas>

    <script type="text/javascript">
        var accellerating = false;
        var breaking = false;

        document.onkeydown = function (e) {
            e = e || window.event;
            if (e.keyCode == '38') {
                // up arrow
                if (accellerating != true) accellerating = true;
            }
            else if (e.keyCode == '40') {
                // down arrow
                if (breaking != true) breaking = true;
            }
            else if (e.keyCode == '37') {
                // left arrow
            }
            else if (e.keyCode == '39') {
                // right arrow
            }
        };

        document.onkeyup = function (e) {
            e = e || window.event;
            if (e.keyCode == '38') {
                // up arrow
                if (accellerating == true) accellerating = false;
            }
            else if (e.keyCode == '40') {
                // down arrow
                if (breaking == true) breaking = false;
            }
            else if (e.keyCode == '37') {
                // left arrow
            }
            else if (e.keyCode == '39') {
                // right arrow
            }
        };

        var canvas = document.getElementById('canvas');
        var ctx = canvas.getContext('2d');

        var ferrari = new Image();
        ferrari.src = "assets/ferrari.png";

        // perspective

        var skyColor = "cyan";

        var y1 = 220;
        var y2 = canvas.height;
        var l_angle = 1.2;
        var r_angle = l_angle;
        var xx1 = 440;
        var xx2 = canvas.width - xx1;
        var stripe_offset_width = 64;
        var stripe_offset_step = 1;
        var border_width = 8;

        // intra frame render
        var stripe_offset = 0;
        var stripe_colors_index = 0;

        var color_sets = [{
            "grass": "green",
            "border": "red",
            "road": "lightgray"
        },
        {
            "grass": "lightgreen",
            "border": "white",
            "road": "gray"
        }];

        background(true);
        foreground(true);

        var speed = 0;

        setInterval(function () {

            if (accellerating == true) {
                speed += 0.1;
            }
            else {
                speed -= 0.05;
            }
            if (breaking == true) {
                speed -= 0.2;
            }

            if (speed == 0) return;
            for (var i = 1; i < speed; i++) {
                background(false);
                foreground(false);
            }
            background(true);
            foreground(true);
        }, 20);

        function foreground(draw) {
            if (draw) {
                ctx.drawImage(ferrari, 9, 64, 84, 48, 420, 480, 84, 48);
            }
        }

        function background(draw) {
            ctx.fillStyle = skyColor;
            ctx.fillRect(0, 0, canvas.width, y1);

            var y_stripe_offset = stripe_offset;
            var y_stripe_colors_index = stripe_colors_index;

            var llx = xx1;
            var llx2 = llx + border_width;
            var rrx = xx2;
            var rrx2 = rrx - border_width;
            var y = y1;

            // set top
            var llx_ = llx;
            var llx2_ = llx2;
            var rrx_ = rrx;
            var rrx2_ = rrx2;
            var y_ = y;

            while (true) {

                if (y_stripe_offset >= stripe_offset_width) {

                    var colors = color_sets[y_stripe_colors_index];

                    if (draw) {
                        // left grass
                        ctx.beginPath();
                        ctx.moveTo(0, y_);
                        ctx.lineTo(llx_, y_);
                        ctx.lineTo(llx, y);
                        ctx.lineTo(0, y);
                        ctx.closePath();
                        ctx.fillStyle = colors.grass;
                        ctx.fill();

                        // left border
                        ctx.beginPath();
                        ctx.moveTo(llx_, y_);
                        ctx.lineTo(llx2_, y_);
                        ctx.lineTo(llx2, y);
                        ctx.lineTo(llx, y);
                        ctx.closePath();
                        ctx.fillStyle = colors.border;
                        ctx.fill();

                        // road
                        ctx.beginPath();
                        ctx.moveTo(llx2_, y_);
                        ctx.lineTo(rrx2_, y_);
                        ctx.lineTo(rrx2, y);
                        ctx.lineTo(llx2, y);
                        ctx.closePath();
                        ctx.fillStyle = colors.road;
                        ctx.fill();

                        // right border
                        ctx.beginPath();
                        ctx.moveTo(rrx2_, y_);
                        ctx.lineTo(rrx_, y_);
                        ctx.lineTo(rrx, y);
                        ctx.lineTo(rrx2, y);
                        ctx.closePath();
                        ctx.fillStyle = colors.border;
                        ctx.fill();

                        // right grass
                        ctx.beginPath();
                        ctx.moveTo(rrx_, y_);
                        ctx.lineTo(canvas.width, y_);
                        ctx.lineTo(canvas.width, y);
                        ctx.lineTo(rrx, y);
                        ctx.closePath();
                        ctx.fillStyle = colors.grass;
                        ctx.fill();
                    }

                    // set new top
                    llx_ = llx;
                    llx2_ = llx2;
                    rrx_ = rrx;
                    rrx2_ = rrx2;
                    y_ = y;

                    y_stripe_offset = 0;
                    y_stripe_colors_index = 1 - y_stripe_colors_index;
                }

                y_stripe_offset += stripe_offset_step;

                llx -= l_angle;
                llx2 = llx + border_width;
                rrx += r_angle;
                rrx2 = rrx - border_width;
                y++;
                if (y >= y2) break;
            }

            stripe_offset -= stripe_offset_step;
            if (stripe_offset < 0) {
                stripe_offset = stripe_offset_width - 1;
                stripe_colors_index = 1 - stripe_colors_index;
            }
        }
    </script>
</body>

</html>